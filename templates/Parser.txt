
import string

from automaton.Functions import direct_afd_algorithm, afd_simulation
from automaton.configuration import replace_reserved_words


class Parser:
    def __init__(self):
        self.results = {}
    
    {% for production in productions %}
    {{ production }}
    {% endfor %}
    
    {% for term in code %}{{ term }}{% endfor %}

    def move(self):
        # Se avanzan los caracteres ignore
        while (self.ignore_afd and
               self.index < len(self.file_information) and
               afd_simulation(self.ignore_afd, replace_reserved_words(
                   self.file_information[self.index]))[0]):
            self.index += 1

        finish = True
        final_index = self.index
        result = None

        # Se simula mientras:
        # - no se encuentre un simbolo que no esta en las transiciones
        # - no se exceda al tamaño del archivo
        while finish and final_index <= len(self.file_information):
            final_index += 1
            (new_result, finish) = afd_simulation(
                self.afd,
                replace_reserved_words(
                    self.file_information[self.index:final_index])
            )
            if new_result:
                result = (new_result, final_index)

        if (final_index > self.index and result):
            initial_index = self.index
            final_index = result[1]
            self.index = result[1]
            if(self.afd.finals_ids[result[0]] < len(self.tokens)):
                self.results[(initial_index, final_index)] = (
                    self.tokens[self.afd.finals_ids[result[0]]],
                    self.file_information[initial_index:final_index]
                )
        else:
            if self.index < len(self.file_information):
                print('Error léxico el caracter {} en la posición: {}'.format(
                    repr(self.file_information[self.index]), self.index))
                self.index += 1

parser = Parser()
parser.parse("inputs/archivo.txt")
